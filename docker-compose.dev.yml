# ═══════════════════════════════════════════════════════════════
# DOCKER COMPOSE - DÉVELOPPEMENT (Override)
# Usage: docker-compose -f docker-compose.yml -f docker-compose.dev.yml up
# ═══════════════════════════════════════════════════════════════

services:
  # ═══════════════════════════════════════════════════════════
  # FRONTEND - Développement
  # ═══════════════════════════════════════════════════════════
  frontend:
    build:
      target: development
    
    # Variables d'environnement spécifiques au dev
    environment:
      NODE_ENV: development
      NEXT_TELEMETRY_DISABLED: 1
      NEXT_PUBLIC_API_URL: ${NEXT_PUBLIC_API_URL:-http://localhost:3001}
    
    # Volumes pour hot-reload maximum
    volumes:
      # Code source
      - ./frontend/src:/app/src:ro
      
      # Configuration
      - ./frontend/next.config.js:/app/next.config.js:ro
      - ./frontend/tailwind.config.ts:/app/tailwind.config.ts:ro
      - ./frontend/postcss.config.mjs:/app/postcss.config.mjs:ro
      - ./frontend/tsconfig.json:/app/tsconfig.json:ro
      
      # Public assets
      - ./frontend/public:/app/public:ro
      
      # Protéger node_modules et .next
      - /app/node_modules
      - /app/.next
    
    # Commande de développement
    command: npm run dev

  # ═══════════════════════════════════════════════════════════
  # BACKEND - Développement
  # ═══════════════════════════════════════════════════════════
  backend:
    build:
      target: development
    
    environment:
      NODE_ENV: development
      DATABASE_URL: ${DATABASE_URL}
      JWT_SECRET: ${JWT_SECRET}
      FRONTEND_URL: ${FRONTEND_URL:-http://localhost:3000}
    
    # Volumes pour hot-reload
    volumes:
      # Code source
      - ./backend/src:/app/src:ro
      
      # Prisma
      - ./backend/prisma:/app/prisma:ro
      
      # Protéger node_modules
      - /app/node_modules
    
    # Commande de développement (tsx watch)
    command: npm run dev

  # ═══════════════════════════════════════════════════════════
  # POSTGRES - Développement
  # ═══════════════════════════════════════════════════════════
  postgres:
    # Logs plus verbeux en dev
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"
